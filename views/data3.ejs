// --- METADATA PARSER HELPER ---
    function parseMetadata(filename) {
        let name = filename;

        // 1. Decode URI components (fixes %E2%80%93 etc.)
        try { name = decodeURIComponent(name); } catch (e) {}

        // 2. Remove Extension
        name = name.replace(/\.[^.]+$/, '');

        // 3. Fix Encoding Artifacts (Common MOJIBAKE for dashes)
        // â is often a CP1252 to UTF-8 mess up of en-dash
        name = name.replace(/â/g, '-').replace(/â/g, '-').replace(/â/g, ''); 

        // 4. Normalize Dashes and Underscores
        name = name.replace(/[\u2013\u2014\u2212]/g, '-');
        name = name.replace(/_/g, ' '); // Convert underscores to spaces

        // 5. Smart Cleaning (Regex)
        // Strategy: Only remove specific "meta" terms if they are inside brackets/parentheses OR at the very end of the string.
        
        // Remove things inside brackets () or [] if they contain "junk" keywords
        // e.g. (Official Video), [4K], (Lyrics), (256kbps)
        name = name.replace(/\s*[(\[][^)\]]*(official|video|lyrics|visualizer|audio|kbps|\d+k|www\.|@)[^)\]]*[)\]]/gi, '');

        // Remove trailing years e.g. (2017) or 2017 at the end
        name = name.replace(/\s*\(?\d{4}\)?\s*$/g, '');

        // Remove specific phrases ONLY at the end of the string case-insensitive
        // This prevents removing "Video" from "Video Games"
        const phrases = [
            'official video', 'music video', 'lyric video', 'visualizer', 
            'official audio', 'with lyrics', 'lyrics', 'video', 'audio', 
            'full song', 'hd', 'hq', '4k'
        ];
        
        // Loop twice to catch combinations like "Official Video Lyrics"
        for(let i=0; i<2; i++) {
            phrases.forEach(phrase => {
                // Regex: Phrase at the end, optional parens/brackets
                const regex = new RegExp(`\\s*[(\\[-]?\\s*${phrase}\\s*[)\\]]?\\s*$`, 'gi');
                name = name.replace(regex, '');
            });
        }

        // Remove Bitrates (128kbps, 320kbps, 256k) if loose in string
        name = name.replace(/\s*-?\s*\(?\d+\s*(kbps|k)\)?/gi, '');

        // 6. Cleanup Formatting
        name = name.replace(/\s+/g, ' ').trim(); // Collapse spaces
        name = name.replace(/^[-–—\s]+|[-–—\s]+$/g, ''); // Trim dashes/spaces from ends
        name = name.replace(/\(\s*\)/g, '').replace(/\[\s*\]/g, ''); // Remove empty brackets

        // 7. Split Logic
        let artist = "UNKNOWN";
        let title = name;

        // Pattern 1: "Artist - Title"
        if (name.includes(' - ')) {
            const parts = name.split(' - ');
            artist = parts[0].trim();
            title = parts.slice(1).join(' - ').trim();
        } 
        // Pattern 2: "Title by Artist"
        else if (name.includes(' by ')) {
            const parts = name.split(' by ');
            title = parts[0].trim();
            artist = parts[1].trim();
        }
        
        return { artist, title };
    }
